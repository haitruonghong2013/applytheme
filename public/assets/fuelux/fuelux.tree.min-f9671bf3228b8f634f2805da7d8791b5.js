!function(e,t){var n=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.tree.defaults,n),this.$element.on("click",".tree-item",e.proxy(function(e){this.selectItem(e.currentTarget)},this)),this.$element.on("click",".tree-folder-header",e.proxy(function(e){this.selectFolder(e.currentTarget)},this)),this.render()};n.prototype={constructor:n,render:function(){this.populate(this.$element)},populate:function(t){var n=this,i=t.parent().find(".tree-loader:eq(0)");i.show(),this.options.dataSource.data(t.data(),function(s){i.hide(),e.each(s.data,function(e,i){var s;if("folder"===i.type){s=n.$element.find(".tree-folder:eq(0)").clone().show(),s.find(".tree-folder-name").html(i.name),s.find(".tree-loader").html(n.options.loadingHTML);var o=s.find(".tree-folder-header");o.data(i),"icon-class"in i&&o.find('[class*="icon-"]').addClass(i["icon-class"])}else"item"===i.type&&(s=n.$element.find(".tree-item:eq(0)").clone().show(),s.find(".tree-item-name").html(i.name),s.data(i));t.hasClass("tree-folder-header")?t.parent().find(".tree-folder-content:eq(0)").append(s):t.append(s)}),n.$element.trigger("loaded")})},selectItem:function(t){if(0!=this.options.selectable){var n=e(t),i=this.$element.find(".tree-selected"),s=[];this.options.multiSelect?e.each(i,function(t,i){var o=e(i);o[0]!==n[0]&&s.push(e(i).data())}):i[0]!==n[0]&&(i.removeClass("tree-selected").find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"]),s.push(n.data())),n.hasClass("tree-selected")?(n.removeClass("tree-selected"),n.find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"])):(n.addClass("tree-selected"),n.find("i").removeClass(this.options["unselected-icon"]).addClass(this.options["selected-icon"]),this.options.multiSelect&&s.push(n.data())),s.length&&this.$element.trigger("selected",{info:s})}},selectFolder:function(t){var n=e(t),i=n.parent();n.find("."+this.options["close-icon"]).length?(i.find(".tree-folder-content").children().length?i.find(".tree-folder-content:eq(0)").show():this.populate(n),i.find("."+this.options["close-icon"]+":eq(0)").removeClass(this.options["close-icon"]).addClass(this.options["open-icon"]),this.$element.trigger("opened",n.data())):(this.options.cacheItems?i.find(".tree-folder-content:eq(0)").hide():i.find(".tree-folder-content:eq(0)").empty(),i.find("."+this.options["open-icon"]+":eq(0)").removeClass(this.options["open-icon"]).addClass(this.options["close-icon"]),this.$element.trigger("closed",n.data()))},selectedItems:function(){var t=this.$element.find(".tree-selected"),n=[];return e.each(t,function(t,i){n.push(e(i).data())}),n}},e.fn.tree=function(i,s){var o,d=this.each(function(){var t=e(this),d=t.data("tree"),a="object"==typeof i&&i;d||t.data("tree",d=new n(this,a)),"string"==typeof i&&(o=d[i](s))});return o===t?d:o},e.fn.tree.defaults={multiSelect:!1,loadingHTML:"<div>Loading...</div>",cacheItems:!0},e.fn.tree.Constructor=n}(window.jQuery);