!function(e){var t=function(t,n){this.element=e(t),this.options=e.extend(!0,{},e.fn.tag.defaults,n),this.values=e.grep(e.map(this.element.val().split(","),e.trim),function(e){return e.length>0}),this.show()};t.prototype={constructor:t,show:function(){var t=this;t.element.parent().prepend(t.element.detach().attr("type","hidden")),t.element.wrap(e('<div class="tags">')).parent().on("click",function(){t.input.focus()}),t.values.length&&e.each(t.values,function(){t.createBadge(this)}),t.input=e('<input type="text">').attr("placeholder",t.options.placeholder).insertAfter(t.element).on("focus",function(){t.element.parent().addClass("tags-hover")}).on("blur",function(){t.skip||(t.process(),t.element.parent().removeClass("tags-hover"),t.element.siblings(".tag").removeClass("tag-important")),t.skip=!1}).on("keydown",function(n){if(188==n.keyCode||13==n.keyCode||9==n.keyCode)!e.trim(e(this).val())||t.element.siblings(".typeahead").length&&!t.element.siblings(".typeahead").is(":hidden")?188==n.keyCode&&(!t.element.siblings(".typeahead").length||t.element.siblings(".typeahead").is(":hidden")?n.preventDefault():(t.input.data("typeahead").select(),n.stopPropagation(),n.preventDefault())):(9!=n.keyCode&&n.preventDefault(),t.process());else if(e.trim(e(this).val())||8!=n.keyCode)t.element.siblings(".tag").removeClass("tag-important");else{var a=t.element.siblings(".tag").length;if(a){var s=t.element.siblings(".tag:eq("+(a-1)+")");s.hasClass("tag-important")?t.remove(a-1):s.addClass("tag-important")}}}).typeahead({source:t.options.source,matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())&&(-1==t.inValues(e)||t.options.allowDuplicates)},updater:e.proxy(t.add,t)}),e(t.input.data("typeahead").$menu).on("mousedown",function(){t.skip=!0})},inValues:function(t){if(this.options.caseInsensitive){var n=-1;return e.each(this.values,function(e,a){return a.toLowerCase()==t.toLowerCase()?(n=e,!1):void 0}),n}return e.inArray(t,this.values)},createBadge:function(t){var n=this;e('<span class="tag">').text(t).append(e('<button type="button" class="close">&times;</button>').on("click",function(){n.remove(n.element.siblings(".tag").index(e(this).closest(".tag")))})).insertBefore(n.element)},add:function(t){var n=this;if(!n.options.allowDuplicates){var a=n.inValues(t);if(-1!=a){var s=n.element.siblings(".tag:eq("+a+")");return s.addClass("tag-warning"),setTimeout(function(){e(s).removeClass("tag-warning")},500),void 0}}this.values.push(t),this.createBadge(t),this.element.val(this.values.join(", "))},remove:function(e){e>=0&&(this.values.splice(e,1),this.element.siblings(".tag:eq("+e+")").remove(),this.element.val(this.values.join(", ")))},process:function(){var t=e.grep(e.map(this.input.val().split(","),e.trim),function(e){return e.length>0}),n=this;e.each(t,function(){n.add(this)}),this.input.val("")},skip:!1};var n=e.fn.tag;e.fn.tag=function(n){return this.each(function(){var a=e(this),s=a.data("tag"),i="object"==typeof n&&n;s||a.data("tag",s=new t(this,i)),"string"==typeof n&&s[n]()})},e.fn.tag.defaults={allowDuplicates:!1,caseInsensitive:!0,placeholder:"",source:[]},e.fn.tag.Constructor=t,e.fn.tag.noConflict=function(){return e.fn.tag=n,this},e(window).on("load",function(){e('[data-provide="tag"]').each(function(){var t=e(this);t.data("tag")||t.tag(t.data())})})}(window.jQuery);